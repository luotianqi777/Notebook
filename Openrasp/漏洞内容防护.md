# 漏洞内容及防护

## SQL注入

- 原理
用户在输入中混入SQL命令，改变SQL语句本来的逻辑。

- 防御
  - 检查SQL执行时的逻辑有无发生变化
  - 过滤含有隐患的输入(黑名单)
  - 匹配符合规则的输入(白名单)

## 命令注入

- 原理
用户通过输入命令执行函数(如:`exec`，`system`，`passthru`等)来执行攻击语句。

- 防御
  - 过滤含有隐患的输入(黑名单)
  - 匹配符合规则的输入(白名单)

## 文件上传

- 原理
利用服务器对文件上传漏洞或者服务器对文件的解析规则漏洞，用户可以通过向服务器上传攻击性的文件，服务器对其解析后执行文件。
- 常见绕过审核方式
  - 改文件后缀名绕过检查
  - 上传正常拓展名文件后对数据抓包进行修改
  - 在正常文件内容中嵌入攻击语句
  - 0x00截断
  - 多个filename属性混淆

- 防御措施
  - 文件拓展名验证(黑白名单)
  - 检查文件MIME属性
  - 文件内容头校验
  - 图片二次渲染
  - 限制文件运行权限
  - 隐藏文件上传路径
  - 上传文件重命名

## 文件包含

- 原理
利用一些文件包含函数(如`include`，`require`等)读取其他文件。

- 利用方式
  - 读取服务器文件
  - 包含远程文件对服务器进行攻击

- 防御
  - 限制访问区域
  - 过滤关键字
  - 禁止远程文件包含
  - 限制文件目录执行权限

## 文件读取

- 原理
用户利用服务器提供的文件下载功能，对文件内容进行读取。

- 防御
  - 限制访问区域
  - 过滤关键字(`../`等)
  - 限制用户访问权限

> 与文件包含漏洞的区别：
> 文件包含漏洞会对文件进行解析，文件读取漏洞则会查看或下载文件。

## 文件删除

- 原理
服务器未对用户输入进行限制，用户可以输入服务器文件路径，服务器对其进行解析后会删除服务器中的文件。

- 防御
检查用户输入，过滤`../`等危险输入

## SSRF

- 原理
服务器从其他服务器应用获取数据但没有对目标地址做过滤与限制，攻击者可以伪造服务端发起请求，对服务器进行攻击。

- 防御
  - 过滤非http(https)协议的请求
  - 限制URL白名单或限制内网IP

## XXE

- 原理
在DTD中引用外部XML实体构造恶意内容，可以进行读取文件内容或执行恶意命令等一系列攻击行为。

- 防御
  - 程序内部禁用外部实体
  - 过滤关键字`<!DOCTYPE`，`SYSTEM`等

## XSS

- 原理
用户将恶意代码写入网页，可以获取被攻击者在目标网站上的cookie等重要信息。

- 防御
  - 过滤html输入
  - 对用户输入进行转码


## RCE代码执行

- 原理
服务器存在输入指令的接口但未严格审查用户输入，用户可以输入恶意指令让服务器执行。

- 防御
  - 检查用户输入
  - 尽量避免命令执行函数的使用

## XPath

> 类似SQL注入，可参考SQL注入

## url重定向

- 原理
通过url重定向使用户访问其他网站，常用于钓鱼。

## TODO

- 文件重命名
- 文件写入
- 目录创建