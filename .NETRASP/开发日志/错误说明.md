# Agent 端请求转发错误的说明文档

## 问题：发送请求后无响应数据

![抓包图片]()

## 测试过程

### 配置参数

> [IAST 节点地址](https://192.168.172.239:8001/%20%20xmirror%20Xmirror!@#/app/node/detail/cmd_98k?id=DMHUEHFXSQADARKH&client=1)

| ip                | port   | AesKey             | AgentID            |
| ----------------- | ------ | ------------------ | ------------------ |
| `192.168.172.239` | `9090` | `WPOIVXHUZINJRDQC` | `DMHUEHFXSQADARKH` |

### 发送数据

#### 请求转发的数据

```json
{
  "id": "DMHUEHFXSQADARKH",
  "ts": 1595854538,
  "msg": {
    "result": {
      "urls": [
        {
          "method": "GET",
          "url": "https://localhost:5001/",
          "data": "",
          "headers": {
            "Cookie": null,
            "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",
            "Upgrade-Insecure-Requests": "1",
            "Connection": null,
            "Referer": null,
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.89 Safari/537.36",
            "Host": "localhost:5001",
            "Accept-Encoding": "gzip, deflate, br",
            "Accept-Language": "zh-CN,zh;q=0.9,en;q=0.8"
          },
          "iastrange": ["sql"]
        }
      ]
    },
    "cmd": 4001
  }
}
```

#### 数据包

```json
{
  "id": "DMHUEHFXSQADARKH",
  "aes": "MR3cGnjbWgLRwZLvoU2sOeLfFp0jOgqb29fmp+bAJcyeBxTH5FkxUd9IeBXvJfskDc7fU23MihegCZfa9TcKNK1Su3kasB1Fu9JPN99/vSVuSnHuR4KqvNWlIMi7WR4Ws/FL+4P54lP/AUAj0iVVxChzOvwbSqz/hnJLVJAfv9++O3cOBY/Y+rOKLckmR3d0X5efk6mr4ynUyu255hwcSkdqU92jtDnIlWeepmNe6xNHAzFXTJf/1Ck0oC8JKpKZXuepLEUgaTWsaPdE77sbm86vNjfVIeSDg6K1fURVo3jlUaol6fei6lnaVbVJ/nOMauuRjxGTG7iPUUvsLsY3afs9sDLtw+SQGeTifHnjW09unJ3TUhtAZm9vkrs0Pnr98jvsRQ3XbZyuBcsw/6eLrQzqnfzMoJlY9neHEVClpX6ShaancPzwM2E6cpABxX0nb2S0bThR3f/oaCo52JXmdu7SKKQA8eoVLK4JKoq5jaKMul+4JYfBC8lprj1zY/HmjRKKaizIiB/hVq+2zVbHtE+hAUkKh+2IYBUHIhA+iesV8baKm1p9n8Q2tUnyVewuz2sRidI2OZUh/jvflAB4UtSiUE4y9KZNT3BQVf1VFJ7eBcugpiq17RJAEL+bZc+6vm1Wr5BGxk/5+c74Js8PKlUPengOdu/9lWSWTZ42yEVtGwuobq35C7DbS3IS1SSh9IE8ZC/8zfyvzXkrOsCU4oX5oGqq6F6Cv+uy3BHwb+sLZBpr28kRwA4Po5QotorJVNwmsA8gLdNh3GRSA3+OKM1m7rT5JNsUlcKFMxfuH6dWVMb6Onw8EciOhvA60A==",
  "aestag": "Z7wGpGgIU7Z/4+aXCXNSHQ==",
  "aesnonce": "qXTvpOfG2iD5wnkL"
}
```

- `aes`的值为请求转发的 json 数据经`AesGcm`格式加密后的字节流转为`Base64`后的字符串
- `aestag`的值为加密算法计算出的`16bit`大小的字节组转为`Base64`后的字符串
- `aesnonce`的值为`12bit`大小的随机字节组转为`Base64`后的字符串
